<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒ ì»¤ë®¤ë‹ˆí‹° - Tip Community</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            padding: 20px; 
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 10px; 
            padding: 30px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.2); 
        }
        h1 { 
            color: #333; 
            margin-bottom: 10px; 
            text-align: center; 
        }
        .subtitle {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
        }
        .form-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
        }
        .form-group { 
            margin-bottom: 15px; 
        }
        label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: bold; 
            color: #333; 
        }
        input, textarea, select { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
            font-size: 14px; 
            font-family: inherit;
        }
        textarea {
            resize: vertical;
        }
        button { 
            padding: 12px 24px; 
            background: #667eea; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 14px; 
            font-weight: bold;
            transition: all 0.3s; 
        }
        button:hover { 
            background: #764ba2; 
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0);
        }
        .btn-delete { 
            background: #e74c3c; 
            font-size: 12px; 
            padding: 5px 10px; 
        }
        .btn-delete:hover { 
            background: #c0392b; 
        }
        .message { 
            padding: 15px; 
            border-radius: 5px; 
            margin-bottom: 15px; 
            display: none; 
            font-weight: 500;
        }
        .message.success { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb; 
        }
        .message.error { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb; 
        }
        .message.show { 
            display: block; 
        }
        .tips-list {
            margin-top: 20px;
        }
        .tip-item { 
            background: #f9f9f9; 
            padding: 15px; 
            border-left: 4px solid #667eea; 
            margin-bottom: 15px; 
            border-radius: 3px; 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start;
            gap: 15px;
        }
        .tip-item.editing {
            background: #e8f4f8;
        }
        .tip-content { 
            flex-grow: 1; 
        }
        .tip-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        .tip-meta {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }
        .tip-author {
            font-style: italic;
            color: #667eea;
        }
        .tip-text {
            color: #333;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .tip-actions { 
            display: flex; 
            gap: 8px;
            flex-shrink: 0;
        }
        .tip-actions button {
            padding: 6px 12px;
            font-size: 12px;
        }
        .edit-form {
            display: grid;
            gap: 10px;
        }
        .edit-form input,
        .edit-form textarea {
            width: 100%;
        }
        .empty-state {
            text-align: center;
            color: #999;
            padding: 40px 20px;
            font-size: 14px;
        }
        .stat-card { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 20px; 
            border-radius: 8px; 
            text-align: center;
            margin-top: 20px;
        }
        .stat-card h3 { 
            font-size: 36px; 
            margin-bottom: 10px; 
        }
        .stat-card p { 
            opacity: 0.9; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’¡ íŒ ì»¤ë®¤ë‹ˆí‹° - Tip Community</h1>
        <div class="subtitle">ë„ì›€ì´ ë  ë§Œí•œ íŒê³¼ ê²½í—˜ì„ ê³µìœ í•˜ëŠ” ì»¤ë®¤ë‹ˆí‹°</div>
        
        <div id="message" class="message"></div>
        
        <!-- íŒ ì‘ì„± í¼ -->
        <div class="form-section">
            <h2>ìƒˆë¡œìš´ íŒ ê³µìœ í•˜ê¸°</h2>
            <div class="form-group">
                <label>ì œëª© *</label>
                <input type="text" id="tipTitle" placeholder="ì§§ê³  ëª…í™•í•œ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="200">
            </div>
            <div class="form-group">
                <label>ì‘ì„±ì (ì„ íƒ)</label>
                <input type="text" id="tipAuthor" placeholder="ë‹‰ë„¤ì„ ë˜ëŠ” ì´ë¦„ (ë¹ˆ ì¹¸ì´ë©´ ìµëª…)" maxlength="100">
            </div>
            <div class="form-group">
                <label>ë‚´ìš© *</label>
                <textarea id="tipContent" rows="6" placeholder="ë„ì›€ì´ ë  ë§Œí•œ íŒì´ë‚˜ ê²½í—˜ì„ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”" maxlength="2000"></textarea>
            </div>
            <button onclick="createTip()">ğŸ’¬ íŒ ê³µìœ í•˜ê¸°</button>
        </div>

        <!-- íŒ ëª©ë¡ -->
        <div>
            <h2>ê³µìœ ëœ íŒ</h2>
            <div id="tipsList" class="tips-list"></div>
            <div id="tipsStats"></div>
        </div>
    </div>

    <script>
        /*
         * API_BASE: ê°œë°œ í™˜ê²½ì—ì„œ FastAPI ì„œë²„ ì£¼ì†Œì…ë‹ˆë‹¤.
         * - ë¸Œë¼ìš°ì €ì—ì„œ í˜¸ì¶œí•  ë•ŒëŠ” ë¡œì»¬ í˜¸ìŠ¤íŠ¸(ì˜ˆ: http://localhost:8000)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
         * - ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í˜¸ìŠ¤íŠ¸ëª…(mysql ë“±)ì€ ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
         */
        const API_BASE = "http://localhost:8000";

        function showMessage(text, type = 'success') {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'message show ' + type;
            setTimeout(() => msg.classList.remove('show'), 3000);
        }

        /*
         * createTip()
         * - ì—­í• : í¼ì—ì„œ ì…ë ¥ë°›ì€ ê°’ì„ ì„œë²„ì— POSTë¡œ ì „ì†¡í•˜ì—¬ íŒì„ ìƒì„±í•©ë‹ˆë‹¤.
         * - ê²€ì¦: ì œëª©/ë‚´ìš©ì´ ë¹„ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
         * - ì„±ê³µ ì‹œ: í¼ ì´ˆê¸°í™” ë° ëª©ë¡ ì¬ë¡œë“œ(loadTips í˜¸ì¶œ).
         */
        async function createTip() {
            const title = document.getElementById('tipTitle').value.trim();
            const author = document.getElementById('tipAuthor').value.trim() || 'anonymous';
            const content = document.getElementById('tipContent').value.trim();
            
            if (!title || !content) { 
                showMessage('ì œëª©ê³¼ ë‚´ìš©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤', 'error'); 
                return; 
            }
            
            try {
                const res = await fetch(`${API_BASE}/tips/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, content, author })
                });
                
                if (res.ok) {
                    document.getElementById('tipTitle').value = '';
                    document.getElementById('tipAuthor').value = '';
                    document.getElementById('tipContent').value = '';
                    showMessage('âœ“ íŒì´ ì„±ê³µì ìœ¼ë¡œ ê³µìœ ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadTips();
                } else {
                    const error = await res.text();
                    showMessage('âœ— ì˜¤ë¥˜: ' + error, 'error');
                }
            } catch (e) { 
                showMessage('âœ— ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + e.message, 'error'); 
            }
        }

        /*
         * loadTips()
         * - ì—­í• : GET /tips/ ë¥¼ í˜¸ì¶œí•´ íŒ ëª©ë¡ì„ ë°›ì•„ì™€ DOMì— ë Œë”ë§í•©ë‹ˆë‹¤.
         * - ë™ì‘: ì‘ë‹µì„ window.tipsCacheì— ì €ì¥í•´ í¸ì§‘ ì·¨ì†Œ ì‹œ ì›ë³µì— ì‚¬ìš©í•©ë‹ˆë‹¤.
         */
        async function loadTips() {
            try {
                const res = await fetch(`${API_BASE}/tips/`);
                const tips = await res.json();
                window.tipsCache = tips;
                
                const list = document.getElementById('tipsList');
                
                if (tips.length === 0) {
                    list.innerHTML = '<div class="empty-state">ì•„ì§ ê³µìœ ëœ íŒì´ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ íŒì„ ê³µìœ í•´ì£¼ì„¸ìš”! ğŸ‘†</div>';
                } else {
                    list.innerHTML = tips.map(t => `
                        <div class="tip-item" id="tip-row-${t.id}">
                            <div class="tip-content" id="tip-info-${t.id}">
                                <div class="tip-title">${escapeHtml(t.title)}</div>
                                <div class="tip-meta">
                                    by <span class="tip-author">${escapeHtml(t.author)}</span> 
                                    Â· ${new Date(t.created_at).toLocaleString('ko-KR')}
                                </div>
                                <div class="tip-text">${escapeHtml(t.content)}</div>
                            </div>
                            <div class="tip-actions" id="tip-actions-${t.id}">
                                <button onclick="editTip(${t.id})">âœï¸ ìˆ˜ì •</button>
                                <button class="btn-delete" onclick="deleteTip(${t.id})">ğŸ—‘ï¸ ì‚­ì œ</button>
                            </div>
                        </div>
                    `).join('');
                }
                
                document.getElementById('tipsStats').innerHTML = `
                    <div class="stat-card">
                        <h3>${tips.length}</h3>
                        <p>ì´ ê³µìœ ëœ íŒ</p>
                    </div>
                `;
            } catch (e) { 
                console.error('íŒ ë¡œë“œ ì‹¤íŒ¨:', e);
                showMessage('âœ— íŒì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
            }
        }

        /*
         * editTip(id)
         * - ì—­í• : í•´ë‹¹ íŒ í•­ëª©ì„ ì…ë ¥í¼ìœ¼ë¡œ ë°”ê¿” ì‚¬ìš©ìê°€ ìˆ˜ì •í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
         * - ì €ì¥ ì‹œ saveTip(id)ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
         */
        function editTip(id) {
            const tip = (window.tipsCache || []).find(x => x.id === id);
            if (!tip) return;
            
            const infoEl = document.getElementById(`tip-info-${id}`);
            const actionsEl = document.getElementById(`tip-actions-${id}`);
            const row = document.getElementById(`tip-row-${id}`);
            
            infoEl.innerHTML = `
                <div class="edit-form">
                    <div>
                        <label>ì œëª©</label>
                        <input id="edit-tip-title-${id}" value="${escapeHtml(tip.title)}" maxlength="200" />
                    </div>
                    <div>
                        <label>ì‘ì„±ì</label>
                        <input id="edit-tip-author-${id}" value="${escapeHtml(tip.author)}" maxlength="100" />
                    </div>
                    <div>
                        <label>ë‚´ìš©</label>
                        <textarea id="edit-tip-content-${id}" rows="5" maxlength="2000">${escapeHtml(tip.content)}</textarea>
                    </div>
                </div>
            `;
            
            actionsEl.innerHTML = `
                <button onclick="saveTip(${id})">ğŸ’¾ ì €ì¥</button>
                <button onclick="cancelEditTip(${id})">âŒ ì·¨ì†Œ</button>
            `;
            
            row.classList.add('editing');
        }

        /*
         * saveTip(id)
         * - ì—­í• : í¸ì§‘í•œ ë‚´ìš©ì„ ì„œë²„ì— PUTìœ¼ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.
         * - ì„±ê³µ ì‹œ ëª©ë¡ì„ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.
         */
        async function saveTip(id) {
            const title = document.getElementById(`edit-tip-title-${id}`).value.trim();
            const author = document.getElementById(`edit-tip-author-${id}`).value.trim() || 'anonymous';
            const content = document.getElementById(`edit-tip-content-${id}`).value.trim();
            
            if (!title || !content) { 
                showMessage('ì œëª©ê³¼ ë‚´ìš©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤', 'error'); 
                return; 
            }
            
            try {
                const res = await fetch(`${API_BASE}/tips/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, content, author })
                });
                
                if (res.ok) {
                    showMessage('âœ“ ë³€ê²½ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
                    loadTips();
                } else {
                    const error = await res.text();
                    showMessage('âœ— ì˜¤ë¥˜: ' + error, 'error');
                }
            } catch (e) { 
                showMessage('âœ— ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + e.message, 'error'); 
            }
        }

        /*
         * cancelEditTip(id)
         * - ì—­í• : í¸ì§‘ ëª¨ë“œë¥¼ ì·¨ì†Œí•˜ê³  ì›ë˜ ë‚´ìš©ì„ ë³µêµ¬í•©ë‹ˆë‹¤.
         * - ì›ë³¸ ë°ì´í„°ëŠ” window.tipsCacheì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤.
         */
        function cancelEditTip(id) {
            const tip = (window.tipsCache || []).find(x => x.id === id);
            if (!tip) return loadTips();
            
            const infoEl = document.getElementById(`tip-info-${id}`);
            const actionsEl = document.getElementById(`tip-actions-${id}`);
            const row = document.getElementById(`tip-row-${id}`);
            
            infoEl.innerHTML = `
                <div class="tip-title">${escapeHtml(tip.title)}</div>
                <div class="tip-meta">
                    by <span class="tip-author">${escapeHtml(tip.author)}</span> 
                    Â· ${new Date(tip.created_at).toLocaleString('ko-KR')}
                </div>
                <div class="tip-text">${escapeHtml(tip.content)}</div>
            `;
            
            actionsEl.innerHTML = `
                <button onclick="editTip(${id})">âœï¸ ìˆ˜ì •</button>
                <button class="btn-delete" onclick="deleteTip(${id})">ğŸ—‘ï¸ ì‚­ì œ</button>
            `;
            
            row.classList.remove('editing');
        }

        /*
         * deleteTip(id)
         * - ì—­í• : ì‚­ì œ í™•ì¸ í›„ DELETE /tips/{id}ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
         * - ì„±ê³µ ì‹œ ëª©ë¡ì„ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.
         */
        async function deleteTip(id) {
            if (!confirm('ì´ íŒì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const res = await fetch(`${API_BASE}/tips/${id}`, { method: 'DELETE' });
                
                if (res.ok) {
                    showMessage('âœ“ íŒì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                    loadTips();
                } else {
                    const error = await res.text();
                    showMessage('âœ— ì˜¤ë¥˜: ' + error, 'error');
                }
            } catch (e) { 
                showMessage('âœ— ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + e.message, 'error'); 
            }
        }

        // HTML íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„ (XSS ë°©ì§€) - í”„ë¡ íŠ¸ì—”ë“œ ë°©ì–´
        // ì„œë²„ì—ì„œë„ ì…ë ¥ ê²€ì¦ì„ í•˜ê³  ìˆìœ¼ë¯€ë¡œ ì´ì¤‘ ë°©ì–´ì…ë‹ˆë‹¤.
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ íŒ ëª©ë¡ í‘œì‹œ
        loadTips();
    </script>
</body>
</html>
